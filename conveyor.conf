include "#!./gradlew -q composeApp:printConveyorConfig"
include "/stdlib/jdk/21/amazon.conf"

app {
    machines = [windows.amd64, linux.aarch64, linux.arm64, mac.aarch64]

    display-name = "Chirp"
    fsname = "chirp"
    vendor = "PL Coding"
    description = "Chirp Chat Application"
    rdns-name = "com.plcoding.chirp"

    url-schemes = ["chirp"]

    inputs += "composeApp/build/libs/composeApp-desktop-*.jar"

    icons = "conveyorResources/logo.png"

    single-instance = true

    license = "MIT"
    copyright = "Â© 2025 PL Coding"
    vcs-url = "https://github.com/philipplackner/Chirp"
    updates = none

    jvm {
        main-class = "com.plcoding.chirp.MainKt"
        gui.main-class = "com.plcoding.chirp.MainKt"

        version = 21

        options = [
            "-Xmx2g",
            "--add-opens=java.base/sun.misc=ALL-UNNAMED",
            "--add-opens=java.base/java.nio=ALL-UNNAMED",
            "--add-opens=java.desktop/sun.awt=ALL-UNNAMED",
            "--add-opens=java.desktop/sun.awt.wl=ALL-UNNAMED",
            "--add-opens=java.desktop/sun.awt.X11=ALL-UNNAMED",
        ]

        modules = [
            java.desktop,
            java.logging,
            java.prefs,
            java.sql,
            jdk.unsupported
        ]
    }

    mac {
        info-plist {
            "com.apple.developer.associated-domains" = [
                "applinks:chirp.pl-coding.com"
            ]
        }
    }

    windows.manifest.application.extensions = [
        {
            category = "windows.appUriHandler",
            host = "chirp.pl-coding.com"
        }
    ]
}

windows {
    installer-type = "msix"

    start-menu = true
    desktop = true

    console = false

    certificate = "self-signed"
}

linux {
    installer-type = "deb"
    applications-menu = true

    desktop-file {
        Name = "Chirp"
        Type = "Application"
        Exec = "chirp %u"
        categories = ["Network", "Chat"]
        keywords = ["chat", "messaging", "chirp"]
        mime-types = ["x-scheme-handler/chirp"]
    }
}

conveyor {
    compatibility-level = 19
    billing-email = "mail@pl-coding.com"
}